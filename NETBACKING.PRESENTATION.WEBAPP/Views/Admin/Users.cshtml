@model IEnumerable<NETBACKING.CORE.APPLICATION.Models.UserModel>
@using NETBACKING.CORE.APPLICATION.Enums

@{
    ViewData["Title"] = "Listado de Usuarios";
}

<h1 class="text-center my-4 text-primary">@ViewData["Title"]</h1>

<div class="d-flex justify-content-between mb-4">
    <div>
        <a asp-action="Index" class="btn btn-outline-secondary me-2">Volver Atrás</a>
        <a asp-action="CreateUser" class="btn btn-primary">Crear Usuario</a>
    </div>
    <div class="input-group" style="width: 200px;">
        <input type="text" id="searchInput" class="form-control form-control-sm" placeholder="Buscar por Cédula" onkeyup="filterUsers()">
        <span class="input-group-text"><i class="bi bi-search"></i></span>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="row" id="userList">
                @foreach (var user in Model)
                {
                    <div class="col-md-6 col-lg-4 mb-4 user-card" data-id="@user.Identification">
                        <div class="card shadow-sm border-0">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="card-title mb-2 text-dark">@user.FirstName @user.LastName</h5>
                                    <!-- Switch para Activar/Desactivar Usuario -->
                                    <form asp-action="ToggleUserStatus" asp-route-id="@user.Id" method="post" class="d-inline">
                                        <label class="switch">
                                            <input type="checkbox" id="toggleStatus-@user.Id" @(user.IsActive ? "checked" : "") onchange="this.form.submit();" />
                                            <span class="slider"></span>
                                        </label>
                                    </form>
                                </div>

                                <p class="card-subtitle text-muted">@user.Role</p>
                                <hr>
                                <p class="card-text">
                                    <strong>Cédula:</strong> @user.Identification <br>
                                    <strong>Correo:</strong> @user.Email <br>
                                    <strong>Usuario:</strong> @user.UserName
                                </p>

                                <!-- Estado del Usuario al final en pequeño -->
                                <div class="user-status text-muted" style="font-size: 0.85rem;">
                                    @if (user.IsActive)
                                    {
                                        <span class="text-success">Estado: Activo</span>
                                    }
                                    else
                                    {
                                        <span class="text-danger">Estado: Inactivo</span>
                                    }
                                </div>

                                <div class="mt-3">
                                    <a class="btn btn-outline-primary btn-sm me-2" asp-action="EditUser" asp-route-id="@user.Id">Editar</a>
                                    @if (user.Role != "Admin")
                                    {
                                        <a class="btn btn-outline-info btn-sm me-2" asp-action="AddProduct" asp-route-id="@user.Id">Agregar Producto</a>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Script de Filtro de Búsqueda -->
<script>
    function filterUsers() {
        const searchInput = document.getElementById("searchInput").value.toLowerCase();
        const userCards = document.querySelectorAll(".user-card");

        userCards.forEach(card => {
            const cedula = card.getAttribute("data-id").toLowerCase();
            card.style.display = cedula.includes(searchInput) ? "block" : "none";
        });
    }
</script>

<style>
    body {
        font-family: 'Roboto', sans-serif;
        background-color: #F7F7F7;
        color: #333;
    }

    .card {
        border-radius: 10px;
        background-color: #ffffff;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .card-body {
        padding: 1.5rem;
    }

    .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #2A2A2A;
    }

    .card-subtitle {
        font-size: 0.9rem;
        font-weight: 300;
        color: #777;
    }

    .text-success {
        color: #28a745 !important;
    }

    .text-danger {
        color: #dc3545 !important;
    }

    .btn-outline-primary {
        font-size: 0.85rem;
        padding: 6px 18px;
        border-radius: 25px;
    }

    .btn-outline-info {
        font-size: 0.85rem;
        padding: 6px 18px;
        border-radius: 25px;
    }

    /* Estilos para el Switch */
    .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 28px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 28px;
    }

    .slider:before {
        content: "";
        position: absolute;
        height: 20px;
        width: 20px;
        border-radius: 50%;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
    }

    input:checked + .slider {
        background-color: #28a745;
    }

    input:checked + .slider:before {
        transform: translateX(32px);
    }
</style>
